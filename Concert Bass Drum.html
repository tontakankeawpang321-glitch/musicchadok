<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏Å‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà (Lunar Short Spiral)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

        :root {
            --primary-red: #c92a2a;
            --dark-red: #8a1c1c;
            --gold: #ffd43b;
            --wood: #4a3728; /* Darker wood for Lunar style */
            --skin: #f4e4bc;
            --bg-color: #121212;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, #252525 0%, #000000 100%);
            color: white;
            margin: 0;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
            touch-action: none;
        }

        header {
            text-align: center;
            padding: 15px;
            background: linear-gradient(to bottom, var(--dark-red), var(--primary-red));
            width: 100%;
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            border-bottom: 2px solid var(--gold);
            z-index: 10;
            flex-shrink: 0;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            color: var(--gold);
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .drum-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }

        /* Drum Pad Styling - Lunar Style (More Modern/Sleek) */
        .drum-pad {
            width: min(70vw, 40vh);
            height: min(70vw, 40vh);
            max-width: 450px;
            max-height: 450px;
            
            border-radius: 50%;
            /* ‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
            background: radial-gradient(circle at 35% 35%, #fffbf0, #eaddcf 50%, #d4b895 100%);
            border: min(2vw, 15px) solid var(--wood);
            
            box-shadow: 
                0 20px 60px rgba(0,0,0,0.9),
                inset 0 0 50px rgba(0,0,0,0.3);
            
            cursor: pointer;
            position: relative;
            transition: transform 0.05s cubic-bezier(0.1, 0.7, 1.0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* Lunar often has distinct rims/lugs visual, represented simply here */
        .drum-pad::after {
            content: '';
            position: absolute;
            width: 94%;
            height: 94%;
            border-radius: 50%;
            border: 2px solid rgba(100, 100, 100, 0.1);
            pointer-events: none;
        }

        .drum-pad:active, .drum-pad.active {
            transform: scale(0.97);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.8),
                inset 0 0 70px rgba(0,0,0,0.5);
        }

        .drum-label {
            margin-top: 30px;
            font-size: 1.3rem;
            color: var(--gold);
            background: rgba(0,0,0,0.8);
            padding: 8px 25px;
            border-radius: 4px;
            border-bottom: 2px solid var(--gold);
            pointer-events: none;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,1);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: scale(0);
            animation: ripple-anim 0.25s ease-out; /* Fast, tight ripple */
            pointer-events: none;
        }

        @keyframes ripple-anim {
            to {
                transform: scale(1.6);
                opacity: 0;
            }
        }

        .controls {
            display: flex;
            gap: 15px;
            padding: 25px;
            justify-content: center;
            background: rgba(0,0,0,0.6);
            width: 100%;
            backdrop-filter: blur(10px);
            position: absolute;
            bottom: 0;
            box-sizing: border-box;
            border-top: 1px solid rgba(255,212,59,0.1);
        }

        button.ctrl-btn {
            padding: 12px 24px;
            border: 1px solid var(--gold);
            background: rgba(0,0,0,0.5);
            color: var(--gold);
            border-radius: 4px; /* More square/modern buttons */
            font-family: 'Sarabun', sans-serif;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        button.ctrl-btn:active {
            transform: scale(0.95);
            background: rgba(255,212,59,0.1);
        }
        
        button.ctrl-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            border-color: #555;
            color: #999;
            background: transparent;
        }

        button.ctrl-btn.recording {
            background: var(--primary-red);
            color: white;
            border-color: #ff6b6b;
            box-shadow: 0 0 15px rgba(201, 42, 42, 0.5);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(201, 42, 42, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(201, 42, 42, 0); }
            100% { box-shadow: 0 0 0 0 rgba(201, 42, 42, 0); }
        }

        #notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: var(--gold);
            padding: 25px 50px;
            border-radius: 8px;
            font-size: 1.2rem;
            border: 1px solid var(--gold);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 100;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <header>
        <h1>ü•Å Lunar Short Spiral</h1>
    </header>

    <div class="drum-container">
        <div class="drum-pad" id="bigDrum">
        </div>
        <div class="drum-label">LUNAR SERIES</div>
    </div>

    <div class="controls">
        <button id="recordBtn" class="ctrl-btn">
            <span>‚óè</span> ‡∏≠‡∏±‡∏î
        </button>
        <button id="stopBtn" class="ctrl-btn" disabled>
            <span>‚ñ†</span> ‡∏´‡∏¢‡∏∏‡∏î
        </button>
        <button id="playBtn" class="ctrl-btn" disabled>
            <span>‚ñ∂</span> ‡∏ü‡∏±‡∏á
        </button>
        <button id="downloadBtn" class="ctrl-btn" disabled>
            <span>‚¨á</span> ‡πÇ‡∏´‡∏•‡∏î
        </button>
    </div>

    <div id="notification">Notification</div>
    <audio id="playbackAudio" style="display:none;"></audio>

    <script>
        // --- Audio Engine (Web Audio API) ---
        let audioCtx;
        let masterGain;
        let compressor;
        let dest;
        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;
        let audioUrl;

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
                
                // Dynamics Compressor - Tight & Punchy settings
                compressor = audioCtx.createDynamicsCompressor();
                compressor.threshold.value = -12; 
                compressor.knee.value = 30; 
                compressor.ratio.value = 15; // High ratio for punch
                compressor.attack.value = 0.003; 
                compressor.release.value = 0.15; // Fast release

                // Master Volume - Powerful
                masterGain = audioCtx.createGain();
                masterGain.gain.value = 3.5; 
                
                // Final EQ - Clean up mud
                const lowpass = audioCtx.createBiquadFilter();
                lowpass.type = 'lowpass';
                lowpass.frequency.value = 280; 

                masterGain.connect(lowpass);
                lowpass.connect(compressor);
                compressor.connect(audioCtx.destination);
                
                dest = audioCtx.createMediaStreamDestination();
                compressor.connect(dest);
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // --- Bass Drum Synthesis Logic (Lunar Short Spiral) ---
        function playBassDrum() {
            initAudio();
            
            if (audioCtx.state === 'suspended') {
                audioCtx.resume().then(() => {
                    generateSound(audioCtx.currentTime);
                });
            } else {
                generateSound(audioCtx.currentTime);
            }
        }

        function generateSound(t) {
            const gainNode = audioCtx.createGain();
            gainNode.connect(masterGain);

            // 1. Main Tone ("Short Spiral" Characteristic)
            const osc = audioCtx.createOscillator();
            osc.type = 'sine';
            
            // Pitch Envelope: Drop faster to simulate tighter head/short shell
            // Starts slightly higher (110Hz) to give a bit more "knock" impact
            osc.frequency.setValueAtTime(110, t); 
            osc.frequency.exponentialRampToValueAtTime(45, t + 0.15); // Fast drop (Spiral effect)
            
            // Gain Envelope: "Tum" impact, but shorter tail
            gainNode.gain.setValueAtTime(0, t);
            gainNode.gain.linearRampToValueAtTime(1.2, t + 0.015); // Fast, soft attack
            // Tail ends firmly at ~0.65s (Short Spiral)
            gainNode.gain.exponentialRampToValueAtTime(0.001, t + 0.65); 
            
            osc.connect(gainNode);
            osc.start(t);
            osc.stop(t + 0.7);

            // 2. Sub-Bass (Body/Weight)
            const subOsc = audioCtx.createOscillator();
            subOsc.type = 'sine';
            subOsc.frequency.setValueAtTime(40, t); // Solid low end
            
            const subGain = audioCtx.createGain();
            subGain.gain.setValueAtTime(0, t);
            subGain.gain.linearRampToValueAtTime(1.3, t + 0.015);
            // Matches main envelope tightly
            subGain.gain.exponentialRampToValueAtTime(0.001, t + 0.65);
            
            subOsc.connect(subGain);
            subGain.connect(masterGain);
            subOsc.start(t);
            subOsc.stop(t + 0.7);
        }

        // --- Interaction Logic ---
        const bigDrum = document.getElementById('bigDrum');

        function triggerDrum(element) {
            playBassDrum(); 

            element.classList.add('active');
            createRipple(element);
            
            setTimeout(() => {
                element.classList.remove('active');
            }, 80); // Faster visual feedback for "Short" feel
        }

        function createRipple(element) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple');
            const size = element.offsetWidth;
            ripple.style.width = size + 'px';
            ripple.style.height = size + 'px';
            ripple.style.left = '0px'; 
            ripple.style.top = '0px';
            
            element.appendChild(ripple);
            setTimeout(() => ripple.remove(), 300);
        }

        // Event Listeners
        bigDrum.addEventListener('mousedown', (e) => {
            e.preventDefault();
            triggerDrum(bigDrum);
        });

        bigDrum.addEventListener('touchstart', (e) => {
            e.preventDefault();
            initAudio(); 
            for (let i = 0; i < e.changedTouches.length; i++) {
                triggerDrum(bigDrum);
            }
        }, { passive: false });

        window.addEventListener('keydown', (e) => {
            if (e.repeat) return;
            if (e.code === 'Space' || e.key === ' ') {
                triggerDrum(bigDrum);
            }
        });

        // --- Recording Logic ---
        const recordBtn = document.getElementById('recordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const playBtn = document.getElementById('playBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const playbackAudio = document.getElementById('playbackAudio');

        recordBtn.addEventListener('click', startRecording);
        stopBtn.addEventListener('click', stopRecording);
        playBtn.addEventListener('click', playRecording);
        downloadBtn.addEventListener('click', downloadRecording);

        function startRecording() {
            initAudio();
            audioChunks = [];
            
            const options = MediaRecorder.isTypeSupported('audio/webm') 
                ? { mimeType: 'audio/webm' } 
                : { mimeType: 'audio/mp4' };

            try {
                mediaRecorder = new MediaRecorder(dest.stream, options);
            } catch (e) {
                showToast("‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á");
                return;
            }
            
            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) audioChunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                audioUrl = URL.createObjectURL(audioBlob);
                playbackAudio.src = audioUrl;
                
                playBtn.disabled = false;
                downloadBtn.disabled = false;
                showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!");
            };

            mediaRecorder.start();
            recordBtn.classList.add('recording');
            recordBtn.innerHTML = "<span>‚óè</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î...";
            recordBtn.disabled = true;
            stopBtn.disabled = false;
            playBtn.disabled = true;
            downloadBtn.disabled = true;
            
            showToast("‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á...");
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                recordBtn.classList.remove('recording');
                recordBtn.innerHTML = "<span>‚óè</span> ‡∏≠‡∏±‡∏î";
                recordBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }

        function playRecording() {
            if (audioUrl) {
                playbackAudio.play();
                showToast("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏î...");
            }
        }

        function downloadRecording() {
            if (audioUrl) {
                const a = document.createElement('a');
                a.href = audioUrl;
                a.download = `lunar_spiral_short_${new Date().getTime()}.wav`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }
        }

        function showToast(msg) {
            const el = document.getElementById('notification');
            el.innerText = msg;
            el.style.opacity = '1';
            setTimeout(() => {
                el.style.opacity = '0';
            }, 2000);
        }

    </script>
</body>
</html>
