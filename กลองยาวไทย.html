<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>กลองยาวไทย (แก้เสียงบ่อมแล้ว)</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body{
    margin:0;
    background:#2d1b0e;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden;
}
#drum{
    width:80vw;
    height:80vw;
    max-width:480px;
    max-height:480px;
    border-radius:50%;
    background:radial-gradient(circle,#f3e5ab 0%,#d6b96c 60%,#8b5a2b 100%);
    box-shadow:
      inset 0 0 30px rgba(0,0,0,.4),
      0 15px 30px rgba(0,0,0,.6);
    position:relative;
    touch-action:none;
}
.khoon{
    position:absolute;
    width:35%;
    height:35%;
    border-radius:50%;
    background:radial-gradient(circle,#3e2723 0%,#5d4037 80%,transparent 100%);
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    opacity:.85;
}
</style>
</head>

<body>

<div id="drum">
    <div class="khoon"></div>
</div>

<script>
/* ================== AUDIO SETUP ================== */
const soundUrls = {
    bom: 'konglong/momlong.wav',
    pa:  'konglong/paklong.wav',
    poeng:'konglong/pengkob.wav'
};

let audioCtx, masterGain, compressor;
let buffers = {};

async function initAudio(){
    if(audioCtx) return;

    audioCtx = new (window.AudioContext||window.webkitAudioContext)({
        latencyHint:'interactive'
    });

    /* Compressor (ลดการกดเบส) */
    compressor = audioCtx.createDynamicsCompressor();
    compressor.threshold.value = -16;
    compressor.knee.value = 24;
    compressor.ratio.value = 4;
    compressor.attack.value = 0.005;
    compressor.release.value = 0.12;
    compressor.connect(audioCtx.destination);

    masterGain = audioCtx.createGain();
    masterGain.gain.value = 1.2;
    masterGain.connect(compressor);

    await loadSounds();
}

async function loadSounds(){
    for(const k in soundUrls){
        try{
            const r = await fetch(soundUrls[k]);
            const a = await r.arrayBuffer();
            buffers[k] = await audioCtx.decodeAudioData(a);
        }catch(e){
            buffers[k] = null;
        }
    }
}

/* ================== PLAY SOUND ================== */
function playSound(type){
    if(!audioCtx) return;
    const t = audioCtx.currentTime;

    const gain = audioCtx.createGain();
    const filter = audioCtx.createBiquadFilter();

    filter.type = 'lowpass';
    filter.frequency.value = 2200;

    gain.gain.setValueAtTime(0,t);

    /* ====== แยกบ่อมโดยเฉพาะ ====== */
    if(type === 'bom'){
        gain.gain.linearRampToValueAtTime(1.4, t+0.03);
        gain.gain.exponentialRampToValueAtTime(0.001, t+0.7);
        filter.frequency.value = 6000;
    }else{
        gain.gain.linearRampToValueAtTime(1.0, t+0.015);
        gain.gain.exponentialRampToValueAtTime(0.001, t+0.45);
    }

    let src;
    if(buffers[type]){
        src = audioCtx.createBufferSource();
        src.buffer = buffers[type];
    }else{
        src = audioCtx.createOscillator();
        if(type==='bom'){
            src.type='square';
            src.frequency.value=260;
            src.frequency.exponentialRampToValueAtTime(120,t+0.25);
        }else if(type==='pa'){
            src.type='triangle';
            src.frequency.value=360;
        }else{
            src.type='square';
            src.frequency.value=650;
        }
    }

    src.connect(filter);
    filter.connect(gain);
    gain.connect(masterGain);

    src.start();
    if(!buffers[type]) src.stop(t+0.8);
}

/* ================== HIT DETECTION ================== */
const drum = document.getElementById('drum');
function hit(e){
    if(!audioCtx) initAudio();
    const rect = drum.getBoundingClientRect();
    const cx = rect.left + rect.width/2;
    const cy = rect.top + rect.height/2;
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;

    const dx = x-cx;
    const dy = y-cy;
    const d = Math.sqrt(dx*dx+dy*dy)/(rect.width/2);

    if(d < 0.35) playSound('bom');
    else if(d > 0.75) playSound('poeng');
    else playSound('pa');
}

drum.addEventListener('mousedown',hit);
drum.addEventListener('touchstart',hit,{passive:false});
</script>

</body>
</html>
