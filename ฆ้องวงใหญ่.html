<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏Ü‡πâ‡∏≠‡∏á‡∏ß‡∏á‡πÉ‡∏´‡∏ç‡πà‡∏à‡∏≥‡∏•‡∏≠‡∏á (Virtual Khong Wong Yai)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

        :root {
            --wood-color: #5d4037;
            --wood-light: #8d6e63;
            --gold-dark: #b8860b;
            --gold-light: #ffd700;
            --bg-color: #1a1a1a;
        }

        * {
            box-sizing: border-box;
            touch-action: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô/‡∏ã‡∏π‡∏°‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            user-select: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            -webkit-user-select: none;
            font-family: 'Sarabun', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: var(--bg-color);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
        .controls {
            position: absolute;
            top: 10px;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(145deg, #f0f0f0, #cacaca);
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            color: #333;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:active {
            transform: scale(0.95);
            background: #d4d4d4;
        }

        button.recording {
            background: #ff4444;
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
        }

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡∏Ü‡πâ‡∏≠‡∏á (‡∏ß‡∏á) */
        .instrument-container {
            position: relative;
            width: 95vw;
            height: 80vh; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
            max-width: 800px;
            max-height: 500px;
            margin-top: 40px;
        }

        /* ‡∏£‡∏≤‡∏á‡πÑ‡∏°‡πâ‡πÇ‡∏Ñ‡πâ‡∏á (‡πÉ‡∏ä‡πâ SVG ‡∏´‡∏£‡∏∑‡∏≠ CSS shape ‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô) */
        .wood-frame {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            height: 100%;
            border-radius: 50% / 40%; /* ‡∏ó‡∏£‡∏á‡∏£‡∏µ */
            border: 40px solid var(--wood-color);
            border-bottom: 0; /* ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ô‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ (‡∏à‡∏≥‡∏•‡∏≠‡∏á) */
            box-shadow: 
                inset 0 0 20px rgba(0,0,0,0.8),
                0 10px 20px rgba(0,0,0,0.5);
            background: radial-gradient(circle at center, transparent 60%, rgba(93, 64, 55, 0.3) 100%);
            pointer-events: none; /* ‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏õ‡πÇ‡∏î‡∏ô‡∏Ü‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ã‡πâ‡∏≠‡∏ô */
        }
        
        /* ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏•‡∏≤‡∏¢‡πÑ‡∏°‡πâ */
        .wood-frame::after {
            content: '';
            position: absolute;
            top: -40px; left: -40px; right: -40px; bottom: 0;
            border-radius: 50% / 40%;
            border: 2px solid var(--wood-light);
            border-bottom: 0;
            pointer-events: none;
            opacity: 0.5;
        }

        /* ‡∏•‡∏π‡∏Å‡∏Ü‡πâ‡∏≠‡∏á */
        .gong {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, var(--gold-light), var(--gold-dark) 60%, #5e4304 90%);
            box-shadow: 
                0 4px 8px rgba(0,0,0,0.6),
                inset 0 -2px 5px rgba(0,0,0,0.5);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: center;
            transition: transform 0.05s;
            z-index: 10;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏π‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ü‡πâ‡∏≠‡∏á (‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏µ) */
        .gong::before {
            content: '';
            position: absolute;
            width: 40%;
            height: 40%;
            background: radial-gradient(circle at 30% 30%, #ffecb3, #b8860b);
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.4);
        }

        .gong:active, .gong.active {
            transform: scale(0.92);
            filter: brightness(1.2);
        }

        /* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÇ‡∏ô‡πâ‡∏ï */
        .note-label {
            position: absolute;
            color: #3e2723;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
            pointer-events: none;
            opacity: 0; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÇ‡∏î‡∏¢ default */
            transition: opacity 0.3s;
            z-index: 11;
        }

        .show-notes .note-label {
            opacity: 1;
        }

        /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏µ */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            width: 100%;
            height: 100%;
            transform: scale(0);
            pointer-events: none;
        }
        
        .ripple.animate {
            animation: ripple-effect 0.4s linear;
        }

        @keyframes ripple-effect {
            to {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* Media Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        @media (max-width: 600px) {
            .gong {
                width: 45px;
                height: 45px;
            }
            .wood-frame {
                border-width: 30px;
            }
            .note-label {
                font-size: 12px;
            }
            .controls button {
                padding: 6px 12px;
                font-size: 12px;
            }
        }

        #audio-player {
            display: none;
            margin-top: 10px;
            width: 90%;
            max-width: 300px;
            height: 30px;
        }

        .status-text {
            color: #fff;
            font-size: 12px;
            margin-top: 5px;
            opacity: 0.8;
            position: absolute;
            bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="controls">
        <button id="btn-toggle-notes" onclick="toggleNotes()">üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏ô‡πâ‡∏ï</button>
        <button id="btn-record" onclick="toggleRecording()">üî¥ ‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
        <button id="btn-play-record" onclick="playRecording()" disabled>‚ñ∂Ô∏è ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏î</button>
        <button id="btn-download" onclick="downloadRecording()" disabled>üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>
    </div>

    <!-- ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà -->
    <audio id="audio-playback" controls style="display:none; position:absolute; bottom: 40px; z-index:200;"></audio>

    <div class="instrument-container" id="instrument">
        <div class="wood-frame"></div>
        <!-- ‡∏•‡∏π‡∏Å‡∏Ü‡πâ‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
    </div>
    
    <div class="status-text" id="status-display">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô)</div>

    <script>
        // --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Sound Synthesis) ---
        let audioCtx;
        let masterGain;
        let recorder;
        let recordedChunks = [];
        let audioBlob = null;
        let destNode; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á

        // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ç‡∏≠‡∏á‡∏Ü‡πâ‡∏≠‡∏á‡∏ß‡∏á‡πÉ‡∏´‡∏ç‡πà (Thai Tuning System - 7 tone equidistant)
        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡πà‡∏≥ (‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á) ‡∏ß‡∏ô‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤
        // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏û‡πÄ‡∏£‡∏≤‡∏∞‡∏ö‡∏ô Digital
        const frequencies = [
            293.66, // D4 (Re) - ‡∏•‡∏π‡∏Å‡∏ó‡∏µ‡πà 1
            329.63, // E4 (Mi)
            369.99, // F#4 (Fah) - Thai Scale approx
            410.00, // G4 (Sol)
            460.00, // A4 (La)
            510.00, // B4 (Ti)
            550.00, // C5 (Do)
            587.33, // D5 (Re)
            659.25, // E5 (Mi)
            739.99, // F#5 (Fah)
            783.99, // G5 (Sol)
            880.00, // A5 (La)
            987.77, // B5 (Ti)
            1046.50, // C6 (Do)
            1174.66, // D6 (Re)
            1318.51  // E6 (Mi) - ‡∏•‡∏π‡∏Å‡∏ó‡∏µ‡πà 16
        ];

        const thaiNotes = ["‡πë", "‡πí", "‡πì", "‡πî", "‡πï", "‡πñ", "‡πó", "‡πëÃá", "‡πíÃá", "‡πìÃá", "‡πîÃá", "‡πïÃá", "‡πñÃá", "‡πóÃá", "‡πëÃáÃá", "‡πíÃáÃá"];
        const westernNotes = ["Re", "Mi", "Fa", "Sol", "La", "Ti", "Do", "Re", "Mi", "Fa", "Sol", "La", "Ti", "Do", "Re", "Mi"];

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext();
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Node ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏≠‡∏≠‡∏Å‡∏•‡∏≥‡πÇ‡∏û‡∏á
                masterGain = audioCtx.createGain();
                masterGain.gain.value = 0.5; // ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á‡∏£‡∏ß‡∏°
                masterGain.connect(audioCtx.destination);

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Node ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á
                destNode = audioCtx.createMediaStreamDestination();
                masterGain.connect(destNode);
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function playGongSound(freq) {
            initAudio();

            const t = audioCtx.currentTime;
            
            // Oscillator 1: Fundamental (Sine wave for depth)
            const osc1 = audioCtx.createOscillator();
            osc1.type = 'sine';
            osc1.frequency.setValueAtTime(freq, t);

            // Oscillator 2: Overtone (Triangle for metallic character)
            const osc2 = audioCtx.createOscillator();
            osc2.type = 'triangle';
            osc2.frequency.setValueAtTime(freq * 2.02, t); // Detune slightly for gong realism

            // Oscillator 3: High frequency transient (The "ting" sound)
            const osc3 = audioCtx.createOscillator();
            osc3.type = 'sine';
            osc3.frequency.setValueAtTime(freq * 5.5, t);

            // Envelope 1 & 2 (Main body)
            const gain1 = audioCtx.createGain();
            gain1.gain.setValueAtTime(0, t);
            gain1.gain.linearRampToValueAtTime(0.5, t + 0.01); // Attack
            gain1.gain.exponentialRampToValueAtTime(0.001, t + 1.5); // Long Decay

            // Envelope 3 (Transient)
            const gain3 = audioCtx.createGain();
            gain3.gain.setValueAtTime(0, t);
            gain3.gain.linearRampToValueAtTime(0.3, t + 0.005);
            gain3.gain.exponentialRampToValueAtTime(0.001, t + 0.1); // Short Decay

            // Connections
            osc1.connect(gain1);
            osc2.connect(gain1);
            osc3.connect(gain3);

            gain1.connect(masterGain);
            gain3.connect(masterGain);

            osc1.start(t);
            osc2.start(t);
            osc3.start(t);

            const duration = 1.5;
            osc1.stop(t + duration);
            osc2.stop(t + duration);
            osc3.stop(t + duration);

            // Clean up nodes after playing
            setTimeout(() => {
                gain1.disconnect();
                gain3.disconnect();
            }, duration * 1000);
        }

        // --- ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á UI ‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ---
        function createGongs() {
            const container = document.getElementById('instrument');
            const totalGongs = 16;
            const containerW = container.clientWidth;
            const containerH = container.clientHeight;
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ß‡∏á‡∏£‡∏µ
            const radiusX = containerW * 0.42; 
            const radiusY = containerH * 0.40;
            const centerX = containerW / 2;
            const centerY = containerH * 0.55; // ‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏á‡∏£‡∏µ (‡∏Ç‡∏¢‡∏±‡∏ö‡∏•‡∏á‡∏°‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢)

            // ‡∏°‡∏∏‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á) ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á (‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á)
            // ‡πÉ‡∏ô CSS/JS 0 rad ‡∏Ñ‡∏∑‡∏≠ 3 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤, -PI/2 ‡∏Ñ‡∏∑‡∏≠ 12 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤, PI ‡∏Ñ‡∏∑‡∏≠ 9 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
            // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤ (‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà setup ‡πÅ‡∏ï‡πà‡∏Ü‡πâ‡∏≠‡∏á‡∏ß‡∏á‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡πà‡∏≥‡∏≠‡∏¢‡∏π‡πà‡∏ã‡πâ‡∏≤‡∏¢)
            // ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏ñ‡∏ß‡πÜ 8-9 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ ‡∏ß‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ 12 ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏ö‡∏ó‡∏µ‡πà 3-4 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
            const startAngle = Math.PI - 0.2; // ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 9 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ (‡∏ã‡πâ‡∏≤‡∏¢)
            const endAngle = 0.2;     // ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 3 ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤ (‡∏Ç‡∏ß‡∏≤)
            // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: Math.cos(PI) = -1 (‡∏ã‡πâ‡∏≤‡∏¢), Math.cos(0) = 1 (‡∏Ç‡∏ß‡∏≤)
            // ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏ô‡∏à‡∏≤‡∏Å ‡∏ã‡πâ‡∏≤‡∏¢ -> ‡∏ö‡∏ô -> ‡∏Ç‡∏ß‡∏≤ 
            
            for (let i = 0; i < totalGongs; i++) {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏•‡∏π‡∏Å
                // ‡πÉ‡∏ä‡πâ interpolation ‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô
                const t = i / (totalGongs - 1); 
                // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏•‡πà‡∏°‡∏∏‡∏°‡∏à‡∏≤‡∏Å PI ‡πÑ‡∏õ 0 (‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°‡∏Ç‡∏≠‡∏á Unit circle ‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏∑‡∏≠ 0->PI ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤‡∏Ñ‡∏∑‡∏≠ PI -> 0)
                const angle = startAngle - (t * (startAngle - endAngle));

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á X, Y
                // X: cos(angle), Y: -sin(angle) (‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÅ‡∏Å‡∏ô Y browser ‡∏•‡∏á‡∏Ñ‡∏∑‡∏≠‡∏ö‡∏ß‡∏Å ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô)
                const x = centerX + radiusX * Math.cos(angle);
                const y = centerY - radiusY * Math.sin(angle);

                const gong = document.createElement('div');
                gong.className = 'gong';
                gong.style.left = `${x - 25}px`; // ‡∏•‡∏ö‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏π‡∏Å‡∏Ü‡πâ‡∏≠‡∏á (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)
                gong.style.top = `${y - 25}px`;
                gong.dataset.note = i; // ‡πÄ‡∏Å‡πá‡∏ö index
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÇ‡∏ô‡πâ‡∏ï
                const label = document.createElement('span');
                label.className = 'note-label';
                label.innerText = thaiNotes[i];
                gong.appendChild(label);

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á Ripple effect element
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                gong.appendChild(ripple);

                // Event Listeners
                const hit = (e) => {
                    e.preventDefault(); // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô double tap zoom
                    playGongSound(frequencies[i]);
                    
                    // Visual feedback
                    gong.classList.add('active');
                    ripple.classList.remove('animate');
                    void ripple.offsetWidth; // Trigger reflow
                    ripple.classList.add('animate');

                    setTimeout(() => gong.classList.remove('active'), 100);
                };

                gong.addEventListener('mousedown', hit);
                gong.addEventListener('touchstart', hit);

                container.appendChild(gong);
            }
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á ---
        function toggleRecording() {
            const btn = document.getElementById('btn-record');
            const status = document.getElementById('status-display');
            initAudio();

            if (btn.classList.contains('recording')) {
                // Stop Recording
                recorder.stop();
                btn.classList.remove('recording');
                btn.innerHTML = 'üî¥ ‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
                status.innerText = '‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß';
            } else {
                // Start Recording
                recordedChunks = [];
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö browser support
                const mimeType = MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg';
                
                try {
                    recorder = new MediaRecorder(destNode.stream, { mimeType: mimeType });
                } catch (e) {
                    alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á');
                    return;
                }

                recorder.ondataavailable = (e) => {
                    if (e.data.size > 0) recordedChunks.push(e.data);
                };

                recorder.onstop = () => {
                    audioBlob = new Blob(recordedChunks, { type: mimeType });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const audioEl = document.getElementById('audio-playback');
                    audioEl.src = audioUrl;
                    
                    document.getElementById('btn-play-record').disabled = false;
                    document.getElementById('btn-download').disabled = false;
                    status.innerText = '‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏•‡πà‡∏ô';
                };

                recorder.start();
                btn.classList.add('recording');
                btn.innerHTML = '‚èπ ‡∏´‡∏¢‡∏∏‡∏î';
                status.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á...';
            }
        }

        function playRecording() {
            const audioEl = document.getElementById('audio-playback');
            if(audioBlob) {
                audioEl.style.display = 'block'; // ‡πÅ‡∏™‡∏î‡∏á player ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
                audioEl.play();
                document.getElementById('status-display').innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏î...';
                audioEl.onended = () => {
                     audioEl.style.display = 'none';
                     document.getElementById('status-display').innerText = '‡πÄ‡∏•‡πà‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß';
                };
            }
        }

        function downloadRecording() {
            if (!audioBlob) return;
            const url = URL.createObjectURL(audioBlob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'khong_wong_sound.webm';
            document.body.appendChild(a);
            a.click();
            setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }, 100);
            document.getElementById('status-display').innerText = '‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢';
        }

        function toggleNotes() {
            const container = document.getElementById('instrument');
            const btn = document.getElementById('btn-toggle-notes');
            container.classList.toggle('show-notes');
            if (container.classList.contains('show-notes')) {
                btn.innerHTML = 'üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô‡πÇ‡∏ô‡πâ‡∏ï';
                btn.style.background = '#ffd700';
            } else {
                btn.innerHTML = 'üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏ô‡πâ‡∏ï';
                btn.style.background = '';
            }
        }

        // ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏∏‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏ô‡∏≤‡∏î
        window.addEventListener('resize', () => {
            const container = document.getElementById('instrument');
            // ‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ü‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
            const gongs = document.querySelectorAll('.gong');
            gongs.forEach(g => g.remove());
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á
            createGongs();
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        window.onload = createGongs;

    </script>
</body>
</html>