<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dry & Tight Snare Drum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        body {
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
            overflow: hidden;
            background-color: #1a1a1a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏Å‡∏•‡∏≠‡∏á‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ */
        .drum-wrapper {
            position: relative;
            border-radius: 50%;
            transition: transform 0.05s ease;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
            touch-action: none;
            flex-shrink: 0;
        }

        /* ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á Snare */
        .snare-size {
            width: 85vw;
            height: 85vw;
            max-width: 400px;
            max-height: 400px;
        }
        
        /* ‡∏Ç‡∏≠‡∏ö‡∏Å‡∏•‡∏≠‡∏á (Rim) */
        .rim {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(145deg, #cfcfcf, #8a8a8a, #cfcfcf);
            box-shadow: 
                0 10px 25px rgba(0,0,0,0.6),
                inset 0 2px 5px rgba(255,255,255,0.8),
                inset 0 -2px 5px rgba(0,0,0,0.5);
            z-index: 10;
        }

        /* ‡∏ô‡πá‡∏≠‡∏ï‡∏¢‡∏∂‡∏î‡∏Å‡∏•‡∏≠‡∏á (Lugs visual) */
        .lug {
            position: absolute;
            width: 16px;
            height: 28px;
            background: linear-gradient(to bottom, #dcdcdc, #808080);
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            z-index: 11;
        }

        /* ‡∏´‡∏ô‡∏±‡∏á‡∏Å‡∏•‡∏≠‡∏á (Drum Head) - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏ï‡∏∂‡∏á‡∏Ç‡∏∂‡πâ‡∏ô */
        .drum-head {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fdfdfd, #ececec, #e0e0e0);
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.15'/%3E%3C/svg%3E");
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        .drum-head.hit {
            background: radial-gradient(circle at 30% 30%, #fffff0, #f0f0f0, #e0e0e0);
            transform: scale(0.99);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 2px;
            pointer-events: none;
        }

        .damper-ring {
            position: absolute;
            top: 20%;
            left: 20%;
            right: 20%;
            bottom: 20%;
            border-radius: 50%;
            border: 3px solid rgba(0,0,0,0.05);
            pointer-events: none;
        }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á */
        .record-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        
        .recording-pulse {
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .visual-ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.1);
            transform: scale(0);
            pointer-events: none;
            animation: ripple-anim 0.15s linear; /* ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏£‡∏±‡∏ß */
        }

        @keyframes ripple-anim {
            to { transform: scale(1.5); opacity: 0; }
        }
    </style>
</head>
<body class="flex flex-col h-screen bg-neutral-900 text-white overflow-hidden">

    <!-- Overlay ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏° Audio Context -->
    <div id="start-overlay">
        <h1 class="text-3xl font-bold mb-4">Dry Snare (‡∏£‡∏±‡∏ß‡πÜ)</h1>
        <div class="text-6xl mb-6">ü•Å</div>
        <p class="mb-8 text-gray-300">‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏´‡πâ‡∏á ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏µ‡∏£‡∏±‡∏ß</p>
        <button id="start-btn" class="px-8 py-3 bg-blue-600 rounded-full font-bold text-lg hover:bg-blue-500 transition shadow-lg">
            Start
        </button>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° -->
    <div class="absolute top-0 w-full p-4 flex justify-between items-center z-50 bg-gradient-to-b from-neutral-900 to-transparent">
        <div>
            <h2 class="text-lg font-bold tracking-widest text-neutral-400">TIGHT SNARE</h2>
        </div>
        
        <!-- ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á -->
        <div class="flex items-center gap-4">
            <div id="status-text" class="text-xs text-red-500 font-bold hidden">REC <span id="rec-timer">00:00</span></div>
            
            <!-- ‡∏õ‡∏∏‡πà‡∏° Record -->
            <button id="record-btn" class="record-btn bg-neutral-800 border-2 border-neutral-700 text-red-500 hover:bg-neutral-700">
                <i class="fas fa-circle"></i>
            </button>
            
            <!-- ‡∏õ‡∏∏‡πà‡∏° Stop (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å) -->
            <button id="stop-btn" class="record-btn bg-red-600 text-white hidden hover:bg-red-500">
                <i class="fas fa-stop"></i>
            </button>
        </div>
    </div>

    <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡∏Å‡∏•‡∏≠‡∏á -->
    <div class="flex-1 flex flex-col items-center justify-center w-full h-full p-4">
        
        <!-- Snare Drum -->
        <div id="snare-drum" class="drum-wrapper snare-size" data-type="snare">
            <div class="rim">
                <div class="lug" style="top: -6px; left: 50%; transform: translateX(-50%);"></div>
                <div class="lug" style="bottom: -6px; left: 50%; transform: translateX(-50%);"></div>
                <div class="lug" style="left: -6px; top: 50%; transform: translateY(-50%) rotate(90deg);"></div>
                <div class="lug" style="right: -6px; top: 50%; transform: translateY(-50%) rotate(90deg);"></div>
                <div class="lug" style="top: 14%; left: 14%; transform: rotate(-45deg);"></div>
                <div class="lug" style="top: 14%; right: 14%; transform: rotate(45deg);"></div>
                <div class="lug" style="bottom: 14%; left: 14%; transform: rotate(45deg);"></div>
                <div class="lug" style="bottom: 14%; right: 14%; transform: rotate(-45deg);"></div>
            </div>
            <div class="drum-head">
                <div class="logo">DRY</div>
                <div class="damper-ring"></div>
            </div>
        </div>

    </div>

    <script>
        // --- Audio Engine ---
        let audioCtx;
        let masterGain;
        let noiseBuffer;
        let isAudioEnabled = false;
        
        // Recorder Variables
        let mediaDest;
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let startTime;
        let timerInterval;

        function createNoiseBuffer() {
            if (!audioCtx) return;
            const bufferSize = audioCtx.sampleRate * 2.0; 
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            noiseBuffer = buffer;
        }

        function playDrumSound(type, velocity = 1) {
            if (!audioCtx || !isAudioEnabled) return;

            const t = audioCtx.currentTime;
            const soundGain = audioCtx.createGain();
            soundGain.connect(masterGain); 

            if (type === 'snare') {
                // ============================================
                // Layer 1: Stick Impact (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö - ‡∏ä‡∏±‡∏î ‡πÄ‡∏î‡πà‡∏ô ‡∏Ñ‡∏°)
                // ============================================
                const stickOsc = audioCtx.createOscillator();
                const stickGain = audioCtx.createGain();
                stickOsc.type = 'square'; 
                
                const stickFilter = audioCtx.createBiquadFilter();
                stickFilter.type = 'lowpass';
                stickFilter.frequency.value = 8000; // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô

                stickOsc.frequency.setValueAtTime(1000, t); 
                stickOsc.frequency.exponentialRampToValueAtTime(100, t + 0.02); // ‡∏•‡∏á‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
                
                stickGain.gain.setValueAtTime(0, t);
                stickGain.gain.linearRampToValueAtTime(1.2 * velocity, t + 0.001); 
                stickGain.gain.exponentialRampToValueAtTime(0.01, t + 0.04); // ‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏∏‡∏î

                stickOsc.connect(stickFilter);
                stickFilter.connect(stickGain);
                stickGain.connect(soundGain);
                stickOsc.start(t);
                stickOsc.stop(t + 0.04);

                // ============================================
                // Layer 2: Main Tone (Body - ‡πÅ‡∏´‡πâ‡∏á ‡πÑ‡∏°‡πà‡∏Å‡∏±‡∏á‡∏ß‡∏≤‡∏•)
                // ============================================
                const osc = audioCtx.createOscillator();
                const oscGain = audioCtx.createGain();
                osc.type = 'sine'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô sine ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î harmonics ‡∏Å‡∏ß‡∏ô
                
                // ‡∏à‡∏π‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (Tight)
                osc.frequency.setValueAtTime(400, t); 
                osc.frequency.exponentialRampToValueAtTime(200, t + 0.05); // Pitch drop ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å
                
                oscGain.gain.setValueAtTime(0, t);
                oscGain.gain.linearRampToValueAtTime(0.5 * velocity, t + 0.002);
                oscGain.gain.exponentialRampToValueAtTime(0.01, t + 0.08); // ‡∏´‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏Å (Dry)

                osc.connect(oscGain);
                oscGain.connect(soundGain);
                osc.start(t);
                osc.stop(t + 0.1);

                // ============================================
                // Layer 3: Snare Wires (Noise - ‡πÅ‡∏´‡πâ‡∏á ‡∏Å‡∏£‡∏≠‡∏ö)
                // ============================================
                const noise = audioCtx.createBufferSource();
                noise.buffer = noiseBuffer;
                
                const noiseFilter = audioCtx.createBiquadFilter();
                noiseFilter.type = 'highpass';
                noiseFilter.frequency.value = 3000; // ‡∏ï‡∏±‡∏î‡∏¢‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ
                
                const noiseGain = audioCtx.createGain();
                noiseGain.gain.setValueAtTime(0, t);
                noiseGain.gain.linearRampToValueAtTime(0.9 * velocity, t + 0.002);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, t + 0.12); // ‡∏´‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏±‡πâ‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ß‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏°‡∏±‡πà‡∏ß

                noise.connect(noiseFilter);
                noiseFilter.connect(noiseGain);
                noiseGain.connect(soundGain);
                noise.start(t);
                noise.stop(t + 0.15);
            }
        }

        // --- Recording Logic ---
        const recordBtn = document.getElementById('record-btn');
        const stopBtn = document.getElementById('stop-btn');
        const statusText = document.getElementById('status-text');
        const recTimer = document.getElementById('rec-timer');

        function setupRecorder() {
            mediaDest = audioCtx.createMediaStreamDestination();
            masterGain.connect(mediaDest); 

            const mimeTypes = [
                'audio/webm;codecs=opus', 
                'audio/webm', 
                'audio/ogg', 
                'audio/mp4',
                ''
            ];
            
            let options = {};
            for (let type of mimeTypes) {
                if (MediaRecorder.isTypeSupported(type)) {
                    if (type) options.mimeType = type;
                    break;
                }
            }

            try {
                mediaRecorder = new MediaRecorder(mediaDest.stream, options);
            } catch (e) {
                console.error("MediaRecorder error:", e);
                alert("‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ");
                return;
            }

            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) {
                    audioChunks.push(e.data);
                }
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(audioChunks, { type: 'audio/webm' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                const date = new Date();
                const timestamp = `${date.getHours()}-${date.getMinutes()}-${date.getSeconds()}`;
                a.style.display = 'none';
                a.href = url;
                a.download = `snare-recording-${timestamp}.webm`;
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 100);

                audioChunks = [];
            };
        }

        function toggleRecord() {
            if (!isAudioEnabled) initAudio();

            if (!isRecording) {
                if (!mediaRecorder) setupRecorder();
                if (!mediaRecorder) return;

                audioChunks = [];
                mediaRecorder.start();
                isRecording = true;
                
                recordBtn.classList.add('hidden');
                stopBtn.classList.remove('hidden');
                stopBtn.classList.add('recording-pulse');
                statusText.classList.remove('hidden');
                
                startTime = Date.now();
                updateTimer();
                timerInterval = setInterval(updateTimer, 1000);

            }
        }

        function stopRecording() {
            if (isRecording && mediaRecorder) {
                mediaRecorder.stop();
                isRecording = false;

                stopBtn.classList.remove('recording-pulse');
                stopBtn.classList.add('hidden');
                recordBtn.classList.remove('hidden');
                statusText.classList.add('hidden');
                
                clearInterval(timerInterval);
                recTimer.innerText = "00:00";
            }
        }

        function updateTimer() {
            const diff = Math.floor((Date.now() - startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            recTimer.innerText = `${m}:${s}`;
        }

        recordBtn.addEventListener('click', toggleRecord);
        stopBtn.addEventListener('click', stopRecording);


        // --- UI & Init ---
        const startOverlay = document.getElementById('start-overlay');
        const startBtn = document.getElementById('start-btn');
        const drums = document.querySelectorAll('.drum-wrapper');

        function initAudio() {
            if (isAudioEnabled) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
            
            masterGain = audioCtx.createGain();
            masterGain.connect(audioCtx.destination);

            createNoiseBuffer();
            
            const buffer = audioCtx.createBuffer(1, 1, 22050);
            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            source.connect(audioCtx.destination);
            source.start(0);

            isAudioEnabled = true;
            setupRecorder();

            startOverlay.style.opacity = '0';
            setTimeout(() => {
                startOverlay.style.display = 'none';
            }, 500);
        }

        startBtn.addEventListener('click', initAudio);
        startOverlay.addEventListener('click', initAudio);

        function animateHit(element, x, y) {
            const head = element.querySelector('.drum-head');
            head.classList.remove('hit');
            void head.offsetWidth; 
            head.classList.add('hit');

            const rect = head.getBoundingClientRect();
            const ripple = document.createElement('div');
            ripple.className = 'visual-ripple';
            
            const relX = x - rect.left;
            const relY = y - rect.top;
            
            ripple.style.left = relX + 'px';
            ripple.style.top = relY + 'px';
            ripple.style.width = '60px'; 
            ripple.style.height = '60px';
            ripple.style.marginLeft = '-30px';
            ripple.style.marginTop = '-30px';

            head.appendChild(ripple);
            setTimeout(() => ripple.remove(), 150); // ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
        }

        // Handle Touch (Multi-touch)
        drums.forEach(drum => {
            drum.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (!isAudioEnabled) { initAudio(); return; }

                const drumType = drum.dataset.type;
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    let velocity = 1.0;
                    if (touch.force > 0) velocity = 0.6 + (touch.force * 0.4);
                    else velocity = 0.8 + (Math.random() * 0.2); 

                    playDrumSound(drumType, velocity);
                    animateHit(drum, touch.clientX, touch.clientY);
                }
            }, { passive: false });

            drum.addEventListener('mousedown', (e) => {
                if (!isAudioEnabled) return;
                const drumType = drum.dataset.type;
                playDrumSound(drumType, 1.0);
                animateHit(drum, e.clientX, e.clientY);
            });
        });

        // Keyboard Support
        document.addEventListener('keydown', (e) => {
            if (!isAudioEnabled || e.repeat) return;
            const key = e.key.toLowerCase();
            
            if (key === 'j' || key === ' ' || key === 'f' || key === 'k') {
                const drum = document.getElementById('snare-drum');
                playDrumSound('snare', 1.0);
                const rect = drum.getBoundingClientRect();
                const randX = (Math.random() * 40) - 20;
                const randY = (Math.random() * 40) - 20;
                animateHit(drum, rect.left + rect.width/2 + randX, rect.top + rect.height/2 + randY);
            }
        });

    </script>
</body>
</html>
