<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Timpani Pro Simulator (Hi-Fi)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');

        * {
            box-sizing: border-box;
            touch-action: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
            user-select: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            -webkit-user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background: #1a1a1a;
            background: radial-gradient(circle, #2c2c2c 0%, #000000 100%);
            height: 100vh;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Sarabun', sans-serif;
            overflow: hidden;
            color: white;
        }

        header {
            position: absolute;
            top: 20px;
            text-align: center;
            z-index: 10;
            pointer-events: none;
            width: 100%;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            color: #d4af37;
        }

        .controls {
            pointer-events: auto;
            margin-top: 10px;
        }

        #record-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #d4af37;
            color: #d4af37;
            padding: 8px 20px;
            border-radius: 20px;
            font-family: 'Sarabun', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        #record-btn.recording {
            background: rgba(220, 20, 60, 0.8);
            border-color: crimson;
            color: white;
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 20, 60, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 20, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 20, 60, 0); }
        }

        p {
            margin: 5px 0 0;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Container */
        .drum-container {
            display: flex;
            justify-content: center;
            align-items: center;
            align-content: center;
            flex-wrap: wrap;
            gap: 15px;
            width: 100%;
            height: 100%;
            padding: 10px;
            max-width: 1200px;
        }

        /* Timpani Styles */
        .timpani {
            position: relative;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.05s ease;
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.9),
                inset 0 0 30px rgba(0,0,0,0.6);
            background: linear-gradient(135deg, #b87333 0%, #5d4037 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        .timpani.active {
            transform: scale(0.96);
        }

        .timpani.active .head {
            background: radial-gradient(circle at 30% 30%, #fff 0%, #e6e0d4 60%, #c5bba8 100%);
            filter: brightness(1.05);
        }

        .head {
            width: 92%;
            height: 92%;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fdfbf7 0%, #e6e0d4 60%, #c5bba8 100%);
            box-shadow: 
                inset 0 0 15px rgba(0,0,0,0.3),
                0 0 5px rgba(0,0,0,0.2);
            position: relative;
            pointer-events: none;
            transition: filter 0.1s;
        }

        .rim {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid #3e2723;
            box-shadow: 
                inset 0 2px 5px rgba(255,255,255,0.2),
                0 4px 10px rgba(0,0,0,0.6);
            pointer-events: none;
        }

        .label {
            position: absolute;
            bottom: 20%;
            font-weight: bold;
            color: rgba(62, 39, 35, 0.7);
            font-size: 1.5rem;
            pointer-events: none;
            text-shadow: 0 1px 1px rgba(255,255,255,0.5);
        }

        /* Fit Screen Sizes */
        .size-32 { width: 40vmin; height: 40vmin; max-width: 280px; max-height: 280px; }
        .size-29 { width: 36vmin; height: 36vmin; max-width: 250px; max-height: 250px; }
        .size-26 { width: 32vmin; height: 32vmin; max-width: 220px; max-height: 220px; }
        .size-23 { width: 28vmin; height: 28vmin; max-width: 200px; max-height: 200px; }

        @media (orientation: landscape) {
            .drum-container { gap: 20px; }
            .size-32 { width: 35vh; height: 35vh; max-width: 350px; max-height: 350px; }
            .size-29 { width: 31vh; height: 31vh; max-width: 310px; max-height: 310px; }
            .size-26 { width: 27vh; height: 27vh; max-width: 270px; max-height: 270px; }
            .size-23 { width: 23vh; height: 23vh; max-width: 230px; max-height: 230px; }
        }

        #start-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 100; transition: opacity 0.5s;
        }
        
        #start-btn {
            padding: 15px 40px;
            font-size: 1.5rem;
            background: #d4af37;
            color: #1a1a1a;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(212, 175, 55, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

    </style>
</head>
<body>

    <header>
        <h1>Timpani Simulator</h1>
        <div class="controls">
            <button id="record-btn">üî¥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
        </div>
        <p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Multi-touch - ‡πÄ‡∏™‡∏µ‡∏¢‡∏á Hi-Fi</p>
    </header>

    <div id="start-overlay">
        <button id="start-btn">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô</button>
        <p style="margin-top: 20px; color: #ccc;">*‡πÉ‡∏™‡πà‡∏´‡∏π‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏°‡∏¥‡∏ï‡∏¥‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</p>
    </div>

    <div class="drum-container">
        <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏° Pan (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤) ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö -->
        <!-- Pan: -1 (‡∏ã‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î) ‡∏ñ‡∏∂‡∏á 1 (‡∏Ç‡∏ß‡∏≤‡∏™‡∏∏‡∏î) -->
        <div class="timpani size-32" data-freq="73.42" data-pan="-0.6">
            <div class="rim"></div>
            <div class="head"></div>
            <div class="label">D2</div>
        </div>

        <div class="timpani size-29" data-freq="87.31" data-pan="-0.2">
            <div class="rim"></div>
            <div class="head"></div>
            <div class="label">F2</div>
        </div>

        <div class="timpani size-26" data-freq="110.00" data-pan="0.2">
            <div class="rim"></div>
            <div class="head"></div>
            <div class="label">A2</div>
        </div>

        <div class="timpani size-23" data-freq="130.81" data-pan="0.6">
            <div class="rim"></div>
            <div class="head"></div>
            <div class="label">C3</div>
        </div>
    </div>

    <script>
        // --- Audio Engine (Hi-Fi) ---
        let audioCtx;
        let masterCompressor = null;
        let mediaStreamDest = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;

        function initAudio() {
            if (!audioCtx) {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                audioCtx = new AudioContext({ latencyHint: 'interactive' });
                
                // Master Limiter/Compressor (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏° Peak ‡πÑ‡∏î‡πâ‡∏î‡∏µ)
                const comp = audioCtx.createDynamicsCompressor();
                comp.threshold.setValueAtTime(-8, audioCtx.currentTime); // ‡∏¢‡∏≠‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
                comp.knee.setValueAtTime(20, audioCtx.currentTime);
                comp.ratio.setValueAtTime(12, audioCtx.currentTime);
                comp.attack.setValueAtTime(0.002, audioCtx.currentTime);
                comp.release.setValueAtTime(0.3, audioCtx.currentTime);
                
                // Booster Gain (Makeup Gain)
                const makeupGain = audioCtx.createGain();
                makeupGain.gain.value = 2.0; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á 2 ‡πÄ‡∏ó‡πà‡∏≤ (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤ 4 ‡πÄ‡∏ó‡πà‡∏≤)

                // Master Volume (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ñ‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏ô)
                const masterVol = audioCtx.createGain();
                masterVol.gain.value = 0.9;

                // Chain
                comp.connect(makeupGain);
                makeupGain.connect(masterVol);
                masterVol.connect(audioCtx.destination);
                
                // Recording Path
                const dest = audioCtx.createMediaStreamDestination();
                masterVol.connect(dest);
                
                window.masterBus = comp; // ‡∏à‡∏∏‡∏î‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                mediaStreamDest = dest;
            }
            
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        // --- Recording Logic ---
        const recordBtn = document.getElementById('record-btn');

        function toggleRecording() {
            if (!audioCtx) initAudio();
            if (isRecording) stopRecording();
            else startRecording();
        }

        function startRecording() {
            if (!mediaStreamDest) return;
            recordedChunks = [];
            const options = { mimeType: 'audio/webm' };
            try {
                mediaRecorder = new MediaRecorder(mediaStreamDest.stream, options);
            } catch (e) {
                mediaRecorder = new MediaRecorder(mediaStreamDest.stream);
            }
            mediaRecorder.ondataavailable = e => { if (e.data.size > 0) recordedChunks.push(e.data); };
            mediaRecorder.onstop = saveRecording;
            mediaRecorder.start();
            isRecording = true;
            recordBtn.textContent = '‚èπ ‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å';
            recordBtn.classList.add('recording');
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.textContent = 'üî¥ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á';
                recordBtn.classList.remove('recording');
            }
        }

        function saveRecording() {
            const blob = new Blob(recordedChunks, { type: 'audio/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            const now = new Date();
            const ts = `${now.getHours()}-${now.getMinutes()}-${now.getSeconds()}`;
            a.download = `timpani-hifi-${ts}.webm`;
            document.body.appendChild(a);
            a.click();
            setTimeout(() => { document.body.removeChild(a); URL.revokeObjectURL(url); }, 100);
        }

        recordBtn.addEventListener('click', toggleRecording);

        // --- Sound Synthesis (Realistic) ---
        function playTimpaniSound(frequency, velocity = 1.0, pan = 0) {
            if (!audioCtx) return;
            const t = audioCtx.currentTime;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Channel Strip ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏≠‡∏á‡πÉ‡∏ö‡∏ô‡∏µ‡πâ
            const drumBus = audioCtx.createGain();
            drumBus.gain.value = 1.0;

            // Panner (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤)
            const panner = audioCtx.createStereoPanner();
            panner.pan.setValueAtTime(pan, t);

            drumBus.connect(panner);
            panner.connect(window.masterBus);

            // --- 1. Membrane Harmonics (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏•‡∏≠‡∏á) ---
            // Timpani ‡∏°‡∏µ Harmonics ‡∏ó‡∏µ‡πà‡∏ã‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (Near-harmonic series)
            const partials = [
                // Ratio, Amplitude, DecayScale
                { r: 1.0,  a: 1.0,  d: 1.0 }, // Fundamental (Pitch ‡∏´‡∏•‡∏±‡∏Å)
                { r: 1.51, a: 0.5,  d: 0.7 }, // Fifth (‡πÅ‡∏£‡∏á‡πÅ‡∏ï‡πà‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤)
                { r: 1.99, a: 0.4,  d: 0.6 }, // Octave (‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÄ‡∏õ‡πä‡∏∞)
                { r: 2.44, a: 0.25, d: 0.5 }, // Third above octave
                { r: 2.9,  a: 0.15, d: 0.4 },
                { r: 3.4,  a: 0.1,  d: 0.35 }
            ];

            partials.forEach((p, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                
                // Sine wave ‡∏ö‡∏£‡∏¥‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Fundamental, Triangle ‡∏ú‡∏™‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Overtone
                osc.type = i === 0 ? 'sine' : 'triangle';

                // Pitch Envelope: Tension ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡∏µ (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏¥‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢)
                // ‡∏ï‡∏µ‡πÅ‡∏£‡∏á = pitch ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞‡∏Å‡∏ß‡πà‡∏≤ (‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á)
                const pitchBend = 1.0 + (0.02 * velocity); 
                osc.frequency.setValueAtTime(frequency * p.r * pitchBend, t);
                osc.frequency.exponentialRampToValueAtTime(frequency * p.r, t + 0.1);

                // Amplitude Envelope
                // ‡∏ï‡∏µ‡πÅ‡∏£‡∏á = ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏≤‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢
                const amp = p.a * velocity;
                const decay = 2.5 * p.d * (0.8 + 0.2 * velocity);

                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(amp, t + 0.004); // Attack ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å
                gain.gain.exponentialRampToValueAtTime(0.001, t + decay);

                // Filter ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Overtones (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏´‡∏•‡∏°‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ó‡∏∏‡πâ‡∏°)
                if (i > 0) {
                    const filter = audioCtx.createBiquadFilter();
                    filter.type = 'lowpass';
                    // ‡∏ï‡∏µ‡πÅ‡∏£‡∏á = ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡∏¥‡∏î (Bright)
                    const cutoff = frequency * (i + 2) * (1 + 2 * velocity);
                    filter.frequency.setValueAtTime(cutoff, t);
                    filter.frequency.exponentialRampToValueAtTime(frequency * i, t + 0.5); // Filter ‡∏õ‡∏¥‡∏î‡∏•‡∏á
                    
                    osc.connect(gain);
                    gain.connect(filter);
                    filter.connect(drumBus);
                } else {
                    osc.connect(gain);
                    gain.connect(drumBus);
                }

                osc.start(t);
                osc.stop(t + decay + 0.1);
            });

            // --- 2. Impact Noise (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πâ‡∏Å‡∏£‡∏∞‡∏ó‡∏ö + Attack) ---
            const noiseBuffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.1, audioCtx.sampleRate);
            const data = noiseBuffer.getChannelData(0);
            for (let i = 0; i < noiseBuffer.length; i++) data[i] = Math.random() * 2 - 1;

            const noise = audioCtx.createBufferSource();
            noise.buffer = noiseBuffer;
            
            const noiseFilter = audioCtx.createBiquadFilter();
            noiseFilter.type = 'bandpass';
            noiseFilter.frequency.value = 400 + (velocity * 2000); // ‡∏ï‡∏µ‡πÅ‡∏£‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÑ‡∏°‡πâ‡∏à‡∏∞‡πÅ‡∏´‡∏•‡∏°‡∏Ç‡∏∂‡πâ‡∏ô
            noiseFilter.Q.value = 1;

            const noiseGain = audioCtx.createGain();
            noiseGain.gain.setValueAtTime(0.6 * velocity, t);
            noiseGain.gain.exponentialRampToValueAtTime(0.001, t + 0.08); // ‡∏™‡∏±‡πâ‡∏ô‡∏°‡∏≤‡∏Å

            noise.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(drumBus);
            noise.start(t);

            // --- 3. Body Resonance (‡πÄ‡∏™‡∏µ‡∏¢‡∏á "‡∏ï‡∏∏‡πä‡∏ö" ‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏á) ---
            const bodyOsc = audioCtx.createOscillator();
            const bodyGain = audioCtx.createGain();
            bodyOsc.type = 'sine';
            bodyOsc.frequency.value = frequency * 0.8; // ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ Fundamental
            
            bodyGain.gain.setValueAtTime(0.3 * velocity, t);
            bodyGain.gain.exponentialRampToValueAtTime(0.001, t + 0.2); // ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏ó‡∏Å

            bodyOsc.connect(bodyGain);
            bodyGain.connect(drumBus);
            bodyOsc.start(t);
            bodyOsc.stop(t + 0.3);

            // Cleanup
            setTimeout(() => {
                drumBus.disconnect();
            }, 3000);
        }

        // --- Interaction ---
        const drums = document.querySelectorAll('.timpani');
        const startBtn = document.getElementById('start-btn');
        const overlay = document.getElementById('start-overlay');

        function startApp() {
            initAudio();
            overlay.style.opacity = '0';
            setTimeout(() => { overlay.style.display = 'none'; }, 500);
        }

        startBtn.addEventListener('click', startApp);
        startBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startApp();
        });

        function hitDrum(element, touchVelocity = 1.0) {
            if (!audioCtx) return;
            const freq = parseFloat(element.dataset.freq);
            const pan = parseFloat(element.dataset.pan);
            
            element.classList.remove('active');
            void element.offsetWidth; // Trigger reflow
            element.classList.add('active');

            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Velocity ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á (Humanize)
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏≤‡∏™‡πå touchVelocity ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô 1 ‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏£‡∏≤‡πÄ‡∏•‡∏¢‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°
            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å touch ‡∏≠‡∏≤‡∏à‡∏à‡∏∞ implement ‡πÅ‡∏£‡∏á‡∏Å‡∏î‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏∏‡πà‡∏°)
            const finalVelocity = Math.min(1.0, touchVelocity * (0.7 + Math.random() * 0.3));

            playTimpaniSound(freq, finalVelocity, pan);
        }

        drums.forEach(drum => {
            // Multi-touch Support
            drum.addEventListener('touchstart', (e) => {
                e.preventDefault();
                for (let i = 0; i < e.changedTouches.length; i++) {
                    hitDrum(drum);
                }
            }, { passive: false });

            drum.addEventListener('mousedown', (e) => {
                if(e.button === 0) hitDrum(drum);
            });
        });

        // Keyboard Support (A,S,D,F)
        window.addEventListener('keydown', (e) => {
            if (e.repeat) return;
            const key = e.key.toLowerCase();
            const map = { 'a': 0, 's': 1, 'd': 2, 'f': 3 };
            if (map.hasOwnProperty(key)) {
                hitDrum(drums[map[key]]);
            }
        });

    </script>
</body>
</html>
